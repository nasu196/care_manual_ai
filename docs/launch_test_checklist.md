# ローンチ前テストチェックリスト

## 🚨 **最優先テスト項目（必須）**

### A1. 基本動作確認
- [ ] **ログイン・ログアウト**: Clerkでログイン→ログアウトが正常動作する
- [ ] **ファイルアップロード**: PDF/Word/Excel/PowerPointのアップロードが成功する
- [ ] **AIチャット基本**: 質問を送信してAIから回答が返ってくる
- [ ] **メモ作成・編集**: 新規メモ作成→編集→保存が正常動作する
- [ ] **共有URL生成**: 共有ボタンからURL生成→共有ページアクセスが動作する

### A2. セキュリティ基本確認（🚨 最重要）

#### **ユーザー分離確認（必須テスト）**
- [ ] **メモデータ分離**: 
  - 手順: ユーザーA でメモ作成→ユーザーB でログイン→ユーザーA のメモが表示されないことを確認
  - 致命度: ★★★（他ユーザーのメモが見える = 機密情報漏洩）
- [ ] **ファイルデータ分離**: 
  - 手順: ユーザーA でファイルアップロード→ユーザーB でログイン→ユーザーA のファイルが表示されないことを確認
  - 致命度: ★★★（他ユーザーのファイルアクセス = 重大なセキュリティ問題）
- [ ] **AIチャット履歴分離**: 
  - 手順: ユーザーA でAIチャット実行→ユーザーB でログイン→ユーザーA のチャット履歴が表示されないことを確認
  - 致命度: ★★★（チャット履歴から業務内容が漏洩）
- [ ] **共有設定分離**: 
  - 手順: ユーザーA で共有URL生成→ユーザーB でログイン→ユーザーA の共有設定が表示されないことを確認
  - 致命度: ★★☆（共有URL経由での間接的なデータアクセス可能性）
- [ ] **活用アイデアキャッシュ分離**: 
  - 手順: ユーザーA でアイデア生成→ユーザーB でログイン→ユーザーA のアイデアが表示されないことを確認
  - 致命度: ★☆☆（業務内容の推測可能性）

#### **直接アクセス防止確認**
- [ ] **URL直接操作防止**: 
  - 手順: ユーザーA のメモ詳細URL（例: /memo/xxx）をコピー→ユーザーB でアクセス→403エラーまたはアクセス拒否される
  - 致命度: ★★★（URLを知られるだけでデータアクセス可能）
- [ ] **ファイル直接アクセス防止**: 
  - 手順: ユーザーA のファイルの直接URL（Storage URL）をコピー→ユーザーB でアクセス→アクセス拒否される
  - 致命度: ★★★（ファイルの直接ダウンロード可能性）
- [ ] **共有URL不正アクセス防止**: 
  - 手順: ユーザーA の共有URL生成→未選択のファイルが共有ページで参照されないことを確認
  - 致命度: ★★☆（意図しないデータ共有）

#### **APIレベル分離確認**
- [ ] **API認証確認**: 
  - 手順: DevTools→Networkタブ→APIリクエスト時に正しいAuthorizationヘッダーが送信されている
  - 手順: 無効なTokenでAPIアクセス→401エラーが返される
- [ ] **APIキー漏洩チェック**: 
  - 手順: DevTools→Networkタブ→リクエストヘッダーにservice_role_keyが含まれていないことを確認
  - 致命度: ★★★（service_role_key漏洩 = 全データアクセス可能）

#### **セッション管理確認**
- [ ] **JWT トークン確認**: 
  - 手順: DevTools→Application→Local Storage/Session Storage→Clerkのトークンが保存されていることを確認
  - 手順: ログアウト後にトークンが削除されることを確認
- [ ] **セッション期限確認**: 
  - 手順: 長時間放置後（1時間以上）→操作実行→セッション期限エラーで適切にログイン画面にリダイレクト
- [ ] **複数タブセッション確認**: 
  - 手順: タブAでログアウト→タブBで操作→適切にログインが要求される

### A3. エラーハンドリング基本
- [ ] **ネットワーク断**: 
  - 手順: DevTools→Networkタブ→Offlineに設定→適切なエラーメッセージが表示される
- [ ] **不正ファイル**: 
  - 手順: .txt/.jpgなど非対応ファイルをアップロード→適切に拒否される
- [ ] **大容量ファイル**: 
  - 手順: 制限を超えるファイルサイズをアップロード→適切に拒否される

---

## 🔍 **重要テスト項目（できるだけ実施）**

### B1. レスポンシブデザイン確認
- [ ] **PC表示**: デスクトップで全機能が適切に表示される
- [ ] **タブレット表示**: iPadサイズで全機能が適切に表示される  
- [ ] **スマートフォン表示**: スマホサイズで全機能が適切に表示される

### B2. 詳細機能確認
- [ ] **OCR機能**: テキスト抽出困難なPDFで「[OCR抽出テキスト]」マーカーが表示される
- [ ] **参照ソース選択**: ファイル選択→AIチャットで選択ファイルのみ参照されることを確認
- [ ] **重要フラグ**: メモの重要フラグ設定→一覧で優先表示されることを確認
- [ ] **活用アイデア更新**: 「アイディアを更新」ボタン→新しい提案が表示される

### B3. データ永続化確認
- [ ] **選択状態保存**: ファイル選択→ページリロード→選択状態が保持される
- [ ] **会話履歴**: チャット→ページリロード→会話履歴が保持される
- [ ] **アイデアキャッシュ**: 提案生成→ページリロード→2日以内なら提案が保持される

---

## 📋 **できたら実施テスト項目（時間があれば）**

### C1. ブラウザ互換性
- [ ] **Chrome**: 最新版Chromeで全機能動作確認
- [ ] **Firefox**: 最新版Firefoxで全機能動作確認  
- [ ] **Safari**: 最新版Safariで全機能動作確認
- [ ] **Edge**: 最新版Edgeで全機能動作確認

### C2. 詳細エラーケース
- [ ] **セッション期限**: 長時間放置後の操作でセッション期限エラーの適切な処理
- [ ] **APIタイムアウト**: AI回答生成の長時間応答でのタイムアウト処理
- [ ] **同時操作**: 複数タブで同時操作時のデータ整合性

### C3. パフォーマンス
- [ ] **初期読み込み**: 初回ページ読み込みが3秒以内
- [ ] **AI回答速度**: 通常の質問で10秒以内に回答生成
- [ ] **大量データ**: 多数のファイル・メモがある状態での動作確認

---

## 🛠 **開発者向け確認項目（ログ・DB確認）**

### D1. データベース操作確認（Supabaseダッシュボードで確認）
- [ ] **manualsテーブル**: ファイルアップロード時にレコードが正しく作成される
- [ ] **manual_chunksテーブル**: テキスト抽出時にチャンクデータが保存される
- [ ] **memosテーブル**: メモ作成・更新時にデータが正しく保存される
- [ ] **share_configsテーブル**: 共有URL生成時にレコードが作成される

### D2. ログ確認（Supabaseダッシュボード→Logs）
- [ ] **Edge Functions ログ**: 各API呼び出し時にエラーが発生していない
- [ ] **認証ログ**: ログイン・ログアウト時に適切なログが出力される
- [ ] **Storage ログ**: ファイルアップロード・削除時にエラーが発生していない

---

## ⚠️ **専門的テスト項目（外部協力が望ましい）**

### E1. セキュリティ専門テスト
- [ ] **XSS対策**: クロスサイトスクリプティング攻撃テスト
- [ ] **SQLインジェクション**: SQLインジェクション攻撃テスト  
- [ ] **CSRF対策**: クロスサイトリクエストフォージェリテスト
- [ ] **セッションハイジャック**: セッション管理の脆弱性テスト

### E2. 負荷テスト
- [ ] **同時接続**: 複数ユーザーの同時アクセステスト
- [ ] **大量データ**: 大量ファイル処理時のパフォーマンステスト
- [ ] **API負荷**: Edge Functions の負荷耐性テスト

---

## 📊 **テスト実行進捗管理**

| 優先度 | 項目 | 実施日 | 結果 | 備考 |
|--------|------|--------|------|------|
| 🚨 | A1. 基本動作確認 | | | |
| 🚨 | A2. セキュリティ基本確認 | | | |
| 🚨 | A3. エラーハンドリング基本 | | | |
| 🔍 | B1. レスポンシブデザイン確認 | | | |
| 🔍 | B2. 詳細機能確認 | | | |
| 🔍 | B3. データ永続化確認 | | | |
| 📋 | C1. ブラウザ互換性 | | | |
| 📋 | C2. 詳細エラーケース | | | |
| 📋 | C3. パフォーマンス | | | |

## 💡 **テスト実行のコツ**

### 🚨 最優先テストの効率的な進め方
1. **A1. 基本動作確認**: まずはこれらが全て動くかを確認→動かない場合は即修正
2. **A2. セキュリティ基本確認**: **最重要**のため時間をかけてでも確実に実施
   - **推奨手順**: Chrome（ユーザーA）+ Firefox（ユーザーB）で同時テスト
   - **または**: Chrome通常モード（ユーザーA）+ Chromeシークレットモード（ユーザーB）
   - **必須確認**: メモ・ファイル・チャット履歴の完全分離
3. **A3. エラーハンドリング**: DevToolsを活用して意図的にエラーを発生させる

### 🔍 効率的なテスト実行順序
1. PC環境で🚨最優先テスト→🔍重要テストを実施
2. その後、スマホ・タブレットでレスポンシブ確認
3. 時間があればブラウザ別確認
4. 最後に📋の詳細項目

### 🛠 ログ・DB確認は「ついで」に
- 機能テスト実行中にSupabaseダッシュボードを開いておく
- 各操作後にテーブルにデータが入っているか軽く確認
- エラーが出た時だけログを詳しく見る

---

## 📖 **問題発見時の対応フロー**

1. **🚨 P0（緊急）**: ログイン不可、データ消失、セキュリティ穴 → 即座に修正
2. **⚠️ P1（高）**: 主要機能不具合、著しいUX問題 → ローンチ前に修正  
3. **📝 P2（中）**: 軽微なUI問題、非主要機能不具合 → ローンチ後対応可能

---

## 🎯 **一人で実行可能なテスト重点ポイント**

✅ **必ずやるべき**
- 基本操作フロー（ログイン→アップロード→AIチャット→メモ作成→共有）
- **🔒 ユーザー分離確認（最重要）**: 他ユーザーのメモ・ファイル・チャット履歴が絶対に見えないこと
- レスポンシブデザイン（PC/タブレット/スマホ）

⚠️ **時間があればやる**  
- 複数ブラウザでの動作確認
- パフォーマンス測定
- 詳細なエラーケーステスト

❌ **一人では困難（外部協力推奨）**
- セキュリティ脆弱性テスト
- 大規模負荷テスト
- アクセシビリティ専門テスト 